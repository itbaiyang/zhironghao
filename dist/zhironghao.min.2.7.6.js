/*! zhironghao 21-10-2016 */
var articleCtrl=angular.module("articleCtrl",[]);articleCtrl.controller("ArticleListCtrl",["$http","$scope","$rootScope","$location","$routeParams",function(a,b,c,d,e){b.list=function(f,g){var h={pageNo:f,pageSize:g};a({url:api_uri+"financialProduct/list",method:"GET",params:h}).success(function(a){console.log(a),0==a.returnCode&&(b.result_list=a.result.datas,b.totalCount=a.result.totalCount,wx.ready(function(){c.getUrl(d.absUrl(),e.id),console.log(e.id,"xiwanga")}))}).error(function(a){d.path("/error")})},b.list(1,100),b.result_list={result:{},returnCode:0},b.article_show=function(a){a.good=!0,c.isNullOrEmpty(a.id)||(d.path("/article/show/"+a.id),a.good=!1)},b.detailActivity=function(){d.path("/article/showActivity")}}]),articleCtrl.controller("ArticleShowCtrl",["$http","$scope","$rootScope","$location","$routeParams",function(a,b,c,d,e){b.init=function(){b.bt_show=0,a({url:api_uri+"financialProduct/detail/"+e.id,method:"GET"}).success(function(a){if(console.log(a),c.shareBankname=a.result.bankname+"-",c.shareProductName=a.result.name,c.desc_detail="额度："+a.result.loanvalue+"  期限："+a.result.loanlife+"  利息："+a.result.rate+"%",console.log(c.desc),console.log(a),wx.ready(function(){c.getUrl(d.absUrl(),e.id),console.log(e.id,"xiwanga")}),0==a.returnCode){b.article_detail=a.result,b.feature_list=a.result.feature,b.apply_List=a.result.conditions,b.id=a.result.id,b.type=a.result.type,console.log(b.type);var f="";b.article_detail.ratecap&&b.article_detail.ratefloor&&(f+="利息率:"+b.article_detail.ratecap+"%~"+b.article_detail.ratefloor+"%\r\n"),b.article_detail.loanvalue&&(f+="贷款额度:"+b.article_detail.loanvalue+"万\r\n"),b.article_detail.loanlife&&(f+="贷款期限:"+b.article_detail.loanlife+"年")}}).error(function(a){})},b.init(),b.apply=function(){c.present_route=d.$$path,c.isNullOrEmpty(b.id)||d.path("/article/apply/"+b.id+b.type)}}]),articleCtrl.controller("ArticleShowActivityCtrl",["$http","$scope","$rootScope","$location","$routeParams",function(a,b,c,d,e){b.apply=function(a){c.present_route=d.$$path,c.isNullOrEmpty(activityID)||d.path("/article/apply/"+activityID+a)},wx.ready(function(){c.getUrl(d.absUrl(),e.id)})}]),articleCtrl.controller("applyCtrl",["$http","$scope","$rootScope","$location","$timeout","$routeParams",function(a,b,c,d,e,f){console.log(f.id),console.log(f.type),b.type=f.type,b.init=function(){a({url:api_uri+"user/setting",method:"GET",params:c.login_user}).success(function(a){0==a.returnCode&&(b.company=a.result,b.savePic())}).error(function(a){})},b.init(),b.savePic=function(){b.img_list_id=[],b.img_list_card=[],a({url:api_uri+"qiniu/getUpToken",method:"GET",params:c.login_user}).success(function(a){if(0==a.returnCode){b.qiniu_token=a.result.uptoken;var d=(Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"personID",uptoken:b.qiniu_token,domain:c.qiniu_bucket_domain,container:"containerID",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(a,b){},BeforeUpload:function(a,d){c.uploading=!0,b.upload_percent=d.percent,c.$apply()},UploadProgress:function(a,c){b.upload_percent=c.percent,b.$apply()},FileUploaded:function(a,d,f){var g=$.parseJSON(f),h="http://"+c.qiniu_bucket_domain+"/"+g.key;e(function(){b.img_list_id.push(h)})},Error:function(a,b,d){c.alert("身份证上传失败！")},UploadComplete:function(){},Key:function(a,b){var d=(new Date).getTime(),e="user/headImg/"+c.login_user.userId+"/"+d;return e}}}),new QiniuJsSDK);d.uploader({runtimes:"html5,flash,html4",browse_button:"personCard",uptoken:b.qiniu_token,domain:c.qiniu_bucket_domain,container:"containerCard",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(a,b){},BeforeUpload:function(a,d){c.uploading=!0,b.upload_percent=d.percent,c.$apply()},UploadProgress:function(a,c){b.upload_percent=c.percent,b.$apply()},FileUploaded:function(a,d,f){var g=$.parseJSON(f),h="http://"+c.qiniu_bucket_domain+"/"+g.key;e(function(){b.img_list_card.push(h)})},Error:function(a,b,d){c.alert("房产证上传失败！")},UploadComplete:function(){},Key:function(a,b){var d=(new Date).getTime(),e="user/headImg/"+c.login_user.userId+"/"+d;return e}}})}}).error(function(a){})},b.submit=function(){var a=c.getSessionObject("share");a||(a={shareName:null,shareId:null});var g={userId:c.login_user.userId,token:c.login_user.token,companyName:b.company.companyName,linkman:b.company.name,mobile:b.company.mobile,productId:f.id,share:a.shareName,shareId:a.shareId},h={userId:c.login_user.userId,token:c.login_user.token,linkman:b.company.name,mobile:b.company.mobile,productId:f.id,share:a.shareName,shareId:a.shareId};console.log(g),console.log(h),0==b.type||1==b.type?"undefined"==typeof g.companyName||""==g.companyName?(b.company.errorMsg="公司名称不能为空",e(function(){b.company.errorMsg=""},2e3)):"undefined"==typeof g.linkman||""==g.linkman?(b.company.errorMsg="联系人不能为空",e(function(){b.company.errorMsg=""},2e3)):"undefined"==typeof g.mobile||""==g.mobile?(b.company.errorMsg="联系电话不能为空",e(function(){b.company.errorMsg=""},2e3)):$.ajax({type:"POST",url:api_uri+"loanApplication/create",data:g,traditional:!0,success:function(a,c,f){0==a.returnCode?($(".alertApply").css("display","block"),e(function(){$(".alertApply").css("display","none"),d.path("/user/center")},2e3),b.$apply()):1001==a.returnCode?(b.company.errorMsg="贵公司已经申请过此产品",e(function(){b.company.errorMsg=""},2e3),b.$apply()):1004==a.returnCode||d.path("/login")},dataType:"json"}):2==b.type&&("undefined"==typeof h.linkman||""==h.linkman?(b.company.errorMsg="联系人不能为空",e(function(){b.company.errorMsg=""},2e3)):"undefined"==typeof h.mobile||""==h.mobile?(b.company.errorMsg="联系电话不能为空",e(function(){b.company.errorMsg=""},2e3)):(console.log("af"),$.ajax({type:"POST",url:api_uri+"loanApplication/create",data:h,traditional:!0,success:function(a,c,f){console.log(a,"success"),0==a.returnCode?($(".alertApply").css("display","block"),e(function(){$(".alertApply").css("display","none"),d.path("/user/center")},2e3),b.$apply()):1001==a.returnCode?(b.company.errorMsg="贵公司已经申请过此产品",e(function(){b.company.errorMsg=""},2e3),b.$apply()):1004==a.returnCode||d.path("/login")},error:function(a,b,c){console.log(a,"error")},dataType:"json"})))},b.removeImgList=function(a,b){a.splice(b,1)}}]);var loginCtrl=angular.module("loginCtrl",[]);loginCtrl.controller("LoginCtrl",["$http","$scope","$rootScope","$location",function(a,b,c,d){b.$root.title="登陆",b.loginUser={mobile:"",password:""},b.error_code_msg={1003:"该用户不存在",2001:"用户名或密码错误",1002:"该用户异常",1:"服务器异常,请稍后再试"};var e=function(a){return""!=a.mobile&&""!=a.password};b.changeErrorMsg=function(a){b.error_msg=a},b.textChange=function(a){b.error_msg=""},b.loginUser={mobile:"",code:""},b.ngBlur=function(){c.isNullOrEmpty(b.loginUser.mobile)?(b.changeErrorMsg("手机号码不能为空"),$("#mobile").focus()):a({url:api_uri+"reg/validateMobile",method:"GET",params:{mobile:b.loginUser.mobile}}).success(function(a){1001==a.returnCode?(b.enableMobile=!0,b.success_msg="手机号输入正确"):(b.enableMobile=!1,b.changeErrorMsg("手机号未注册"))}).error(function(a){})},b.login_zrh=function(){var f=b.loginUser;e(f)&&a({url:api_uri+"auth/web",method:"POST",params:f}).success(function(a){if(0==a.returnCode){c.login_user={userId:a.result.split("_")[0],token:a.result.split("_")[1]},c.putObject("login_user",c.login_user);var e=c.getSessionObject("present_route"),f="";e?e.indexOf("/article/apply/")>-1?(f=e,c.removeSessionObject("present_route")):(f="/user/center",c.removeSessionObject("present_route")):f="/user/center",c.wx_client?window.location.href=api_uri+"wx/toOAuth?url="+encodeURIComponent(root_uri+f):d.path(f)}else{var g=b.error_code_msg[a.returnCode];g||(g="登录失败"),b.error_msg=g}}).error(function(a){b.changeErrorMsg("网络故障请稍后再试......"),d.path("/login")})},b.register_zrh=function(){d.path("/register/step1")},b.reset=function(){d.path("/register/reset1")}}]);var registerCtrl=angular.module("registerCtrl",[]);registerCtrl.controller("RegStep1Ctrl",["$http","$scope","$rootScope","$location","$timeout",function(a,b,c,d,e){b.registerUser={mobile:"",code:""},b.isVerify=!1,b.enableMobile=!1,b.error_msg="",$("#mobile").focus(),b.changeErrorMsg=function(a){b.error_msg=a},b.sms_second=60,b.send_sms=!0,b.times=function(){b.sms_second>0?(b.send_sms=!1,b.sms_second--,e(function(){b.times()},1e3)):b.sms_second<=0&&(b.send_sms=!0,b.sms_second=60)},b.send_code=function(){c.isNullOrEmpty(b.registerUser.mobile)?(b.changeErrorMsg("手机号码不能为空"),$("#mobile").focus()):a({url:api_uri+"reg/validateMobile",method:"GET",params:{mobile:b.registerUser.mobile}}).success(function(d){0==d.returnCode?(b.enableMobile=!0,b.times(),a({url:api_uri+"reg/sendSms",method:"GET",params:{mobile:b.registerUser.mobile,token:c.encryptByDES(b.registerUser.mobile),timestamp:moment().format("X")}}).success(function(a){0==a.returnCode?b.changeErrorMsg("短信验证码已经发送到你的手机"):b.changeErrorMsg(a.returnCode)}).error(function(a){})):1001==d.returnCode?(b.enableMobile=!1,b.changeErrorMsg("用户已经注册")):2102==d.returnCode?(b.enableMobile=!1,b.changeErrorMsg("手机号错误")):b.changeErrorMsg(d.returnCode)}).error(function(a){})},b.changeCode=function(){b.enableMobile&&!c.isNullOrEmpty(b.registerUser.code)?b.isVerify=!0:b.isVerify=!1},b.validateCode=function(){b.isVerify&&a({url:api_uri+"reg/validateSms",method:"POST",params:b.registerUser}).success(function(a){0==a.returnCode?d.path("/register/step2/"+b.registerUser.mobile+"/"+a.result):b.changeErrorMsg(a.result)}).error(function(a){})}}]),registerCtrl.controller("RegStep2Ctrl",["$http","$scope","$rootScope","$location","$routeParams","$timeout",function(a,b,c,d,e,f){var g=c.getSessionObject("share");g||(g={shareName:null,shareId:null}),b.registerUser={mobile:e.mobile,password:"",validatePwd:"",token:e.token,share:g.shareName,shareId:g.shareId},b.changeErrorMsg=function(a){b.error_msg=a,f(function(){b.changeErrorMsg("")},5e3)},b.textChange=function(){b.registerUser.password==b.registerUser.validatePwd?(b.success_msg="点击注册按钮，注册用户",b.error_msg=""):(b.success_msg="",b.error_msg="两次输入的密码不一致")},b.user_register=function(){b.registerUser.password==b.registerUser.validatePwd?a({url:api_uri+"reg/regist",method:"POST",params:b.registerUser}).success(function(e){0==e.returnCode&&(alert("注册成功"),c.putObject("login_mobile",b.registerUser.mobile),a({url:api_uri+"auth/web",method:"POST",params:{mobile:b.registerUser.mobile,password:b.registerUser.password}}).success(function(a){0==a.returnCode?(c.login_user={userId:a.result.split("_")[0],token:a.result.split("_")[1]},c.putObject("login_user",c.login_user),d.path("/article/list")):b.changeErrorMsg(a.result)}).error(function(a){}))}).error(function(a){}):b.changeErrorMsg("两次密码输入的不一致")}}]),registerCtrl.controller("ResetStep1Ctrl",["$http","$scope","$rootScope","$location","$timeout",function(a,b,c,d,e){b.resetUser={mobile:"",code:""},b.isVerify=!1,b.enableMobile=!1,b.error_msg="",b.changeErrorMsg=function(a){b.error_msg=a,e(function(){b.changeErrorMsg("")},5e3)},b.sms_second=60,b.send_sms=!0,b.times=function(){b.sms_second>0?(b.send_sms=!1,b.sms_second--,e(function(){b.times()},1e3)):b.sms_second<=0&&(b.send_sms=!0,b.sms_second=60)},b.send_code=function(){c.isNullOrEmpty(b.resetUser.mobile)?(b.changeErrorMsg("手机号码不能为空"),$("#mobile").focus()):a({url:api_uri+"reg/validateMobile",method:"GET",params:{mobile:b.resetUser.mobile}}).success(function(d){1001==d.returnCode?(b.enableMobile=!0,b.times(),a({url:api_uri+"reg/sendSms2",method:"GET",params:{mobile:b.resetUser.mobile,token:c.encryptByDES(b.resetUser.mobile),timestamp:moment().format("X")}}).success(function(a){0==a.returnCode?($("#code").focus(),b.changeErrorMsg("短信验证码已经发送到你的手机")):b.changeErrorMsg(a.result)}).error(function(a){})):2102==d.returnCode?(b.enableMobile=!1,b.changeErrorMsg("手机号码错误")):0==d.returnCode&&(b.enableMobile=!1,b.changeErrorMsg("手机号码未注册"))}).error(function(a){})},b.changeCode=function(){b.enableMobile&&!c.isNullOrEmpty(b.resetUser.code)?b.isVerify=!0:b.isVerify=!1},b.validateCode=function(){b.isVerify&&a({url:api_uri+"reg/validateSms",method:"POST",params:b.resetUser}).success(function(a){0==a.returnCode?d.path("/register/reset2/"+b.resetUser.mobile+"/"+a.result):b.changeErrorMsg(a.result)}).error(function(a){})}}]),registerCtrl.controller("ResetStep2Ctrl",["$http","$scope","$rootScope","$location","$routeParams",function(a,b,c,d,e){b.resetUser={mobile:e.mobile,password:"",validatePwd:"",token:e.token},b.textChange2=function(){b.resetUser.password==b.resetUser.validatePwd?(b.success_msg="点击重置按钮，重置密码",b.error_msg=""):(b.success_msg="",b.error_msg="两次输入的密码不一致")},b.user_reset=function(){a({url:api_uri+"reg/reset",method:"POST",params:b.resetUser}).success(function(e){0==e.returnCode&&(alert("重置密码成功"),c.putObject("login_mobile",b.resetUser.mobile),a({url:api_uri+"auth/web",method:"POST",params:{mobile:b.resetUser.mobile,password:b.resetUser.password}}).success(function(a){0==a.returnCode&&(c.login_user={userId:a.result.split("_")[0],token:a.result.split("_")[1]},c.putObject("login_user",c.login_user),d.path("/article/list"))}).error(function(a){}))}).error(function(a){})}}]);var userCtrl=angular.module("userCtrl",["mobiscroll-select"]);userCtrl.controller("UserCenterCtrl",["$http","$scope","$rootScope","$timeout","$location","$interval",function(a,b,c,d,e,f){b.message=!1,b.msg_red_see=!1,b.settings={theme:"ios",mode:"scroller",display:"inline",lang:""},b.init=function(){null==c.login_user.userId||""==c.login_user.userId?e.path("/login"):(a({url:api_uri+"user/center",method:"GET",params:c.login_user}).success(function(a){console.log(a),0==a.returnCode?(b.nickname=a.result.nickname,b.batting=a.result.batting,b.value=a.result.value,b.position=a.result.position,b.headImg=a.result.headImg,b.msgCount=a.result.msgCount,b.nickname||e.path("/user/add_name")):(c.removeObject("login_user"),e.path("/login")),b.init_role()}).error(function(a){c.removeObject("login_user"),e.path("/login")}),b.list(1,100),b.myList(1,100))},b.init_role=function(){a({url:api_uri+"user/role",method:"GET",params:c.login_user}).success(function(a){0==a.returnCode&&(b.role=a.result)}).error(function(a){})},b.list=function(d,e){b.type||(b.type="1");var f={userId:c.login_user.userId,token:c.login_user.token,pageNo:d,pageSize:e};a({url:api_uri+"loanApplication/list",method:"GET",params:f}).success(function(a){console.log(a),0==a.returnCode&&(0==a.result.totalCount?b.message_list=!1:(b.message_list=!0,b.result_list=a.result.datas,b.totalCount=a.result.totalCount,angular.forEach(b.result_list,function(a){0==b.type||1==b.type&&(0==a.status||1==a.status?(a.jindu="10",a.progressText="准备中",b.message=!0):2==a.status?(a.jindu="25",a.progressText="下户",b.message=!0):3==a.status?(a.jindu="40",a.progressText="审批中",b.message=!0):4==a.status?(a.jindu="55",a.progressText="审批通过",b.message=!0):5==a.status?(a.jindu="70",a.progressText="开户",b.message=!0):6==a.status?(a.jindu="85",a.progressText="放款",b.message=!0):7==a.status?(a.jindu="100",a.progressText="完成融资",b.message=!0):a.status==-1&&(a.jindu="0",a.progressText="申请已经取消"))})))}).error(function(a){})},b.myList=function(d,e){b.type||(b.type="1");var f={userId:c.login_user.userId,token:c.login_user.token,pageNo:d,pageSize:e};a({url:api_uri+"loanApplication/myList",method:"GET",params:f}).success(function(a){console.log(a),0==a.returnCode&&(0==a.result.totalCount?(b.message_myList=!1,0==b.message_myList&&0==b.message_list?b.message=!1:b.message=!0):(b.message_myList=!0,b.my_list=a.result.datas,b.myTotalCount=a.result.totalCount,angular.forEach(b.my_list,function(a){0==b.type||1==b.type&&(0==a.status||1==a.status?(a.jindu="10",a.progressText="准备中",a.statusNextText="下户",a.progressNext="审核中",a.progressTextNext="开始下户",b.message=!0):2==a.status?(a.jindu="25",a.progressText="下户",a.statusNextText="审批中",a.progressNext="审核中",a.progressTextNext="开始审批",b.message=!0):3==a.status?(a.jindu="40",a.progressText="审批中",a.statusNextText="审批通过",a.progressNext="审核中",a.progressTextNext="审核通过",b.message=!0):4==a.status?(a.jindu="55",a.progressText="审批通过",a.statusNextText="开户",a.progressNext="审核中",a.progressTextNext="马上开户",b.message=!0):5==a.status?(a.jindu="70",a.progressText="开户",a.statusNextText="放款",a.progressNext="审核中",a.progressTextNext="开始放款",b.message=!0):6==a.status?(a.jindu="85",a.progressText="放款",a.statusNextText="完成融资",a.progressNext="审核中",a.progressTextNext="成功融资",b.message=!0):7==a.status?(a.jindu="100",a.progressText="完成融资",a.statusNextText="完成融资",a.progressNext="审核中",a.progressTextNext="完成融资",b.message=!0):a.status==-1&&(a.jindu="0",a.triangle="20",a.textPosition="5",a.progressText="申请已经取消"))})))}).error(function(a){})},b.alert=!1,b.alert_over=!1,b.alert_common=function(a,c){b.alert=!0,b.applyId=c,b.status=a,console.log(a,c)},b.alert_overdue=function(a,c,d){b.dateTime=d,b.alert_over=!0,b.applyId=c,b.status=a,b.alertText="延长时间",b.alertText2="请说明原因（必填）"},b.alert_come2=function(a){b.alert_stop=!0,b.applyId=a,b.alertText2="请说明中止原因（必填）"},b.init(),b.userSetting=function(){e.path("/user/setting/")},b.userMessage=function(){e.path("/user/message")},b.my_apply=function(a,b){c.isNullOrEmpty(a)||e.path("/user/companyDetail/"+a+"/"+b)},b.my_work=function(a,b){c.isNullOrEmpty(a)||e.path("/user/companyDetail/"+a+"/"+b)},b.closeAlert=function(a,c){b.alert=!1,b.alert_stop=!1,b.stopPropagation&&c.stopPropagation()},b.receive=function(a){var d={userId:c.login_user.userId,token:c.login_user.token,applyId:a};$.ajax({type:"POST",url:api_uri+"applyBankDeal/receive",data:d,traditional:!0,success:function(a,c,d){0==a.returnCode?(b.list(1,100),b.myList(1,100),b.$apply()):console.log(a)},dataType:"json"})},b.rejected=function(a){var d={userId:c.login_user.userId,token:c.login_user.token,applyId:a};console.log(d),$.ajax({type:"POST",url:api_uri+"applyBankDeal/rejected",data:d,traditional:!0,success:function(a,c,d){console.log(a),0==a.returnCode?(b.list(1,100),b.myList(1,100),b.$apply()):console.log(a)},error:function(a,b,c){console.log(a)},dataType:"json"})},b.stop=function(){var a={userId:c.login_user.userId,token:c.login_user.token,applyId:b.applyId,reason:b.reason};$.ajax({type:"POST",url:api_uri+"applyBankDeal/stop",data:a,traditional:!0,success:function(a,c,d){console.log(a),0==a.returnCode?(b.alert_stop=!1,b.list(1,100),b.myList(1,100),b.$apply()):console.log(a)},error:function(a,b,c){console.log(a)},dataType:"json"})},b.submit_status=function(){var a={userId:c.login_user.userId,token:c.login_user.token,expectDateBank:b.days,reason:b.reason,applyId:b.applyId,status:b.status};console.log(a),a.expectDateBank?$.ajax({type:"POST",url:api_uri+"applyBankDeal/refer",data:a,traditional:!0,success:function(a,c,e){0==a.returnCode?(b.alert=!1,$(".alertCenterSubmit").css("display","block"),d(function(){$(".alertCenterSubmit").css("display","none")},2e3),b.list(1,100),b.myList(1,100),b.$apply()):console.log(a)},dataType:"json"}):(b.msg_red="请输入预计时间",b.msg_red_see=!0,d(function(){b.msg_red_see=!1},3e3))}}]),userCtrl.controller("MessageCtrl",["$http","$scope","$rootScope","$timeout","$location",function(a,b,c,d,e){b.list=function(d,e){b.type||(b.type="1");var f={userId:c.login_user.userId,token:c.login_user.token,pageNo:d,pageSize:e};a({url:api_uri+"zrh/message/listc",method:"GET",params:f}).success(function(a){console.log(a),0==a.returnCode&&(0==a.result.totalCount?b.message_list=!1:(b.message_list=a.result.datas,b.totalCount=a.result.totalCount))}).error(function(a){})},b.list(1,20),b.read_message=function(d,e){var f={userId:c.login_user.userId,token:c.login_user.token,id:d};a({url:api_uri+"zrh/message/detailc",method:"GET",params:f}).success(function(a){0==a.returnCode&&b.my_apply(e,0)}).error(function(a){})},b.my_apply=function(a,b){c.isNullOrEmpty(a)||e.path(a+"/"+b)}}]),userCtrl.controller("CompanyDetailCtrl",["$http","$scope","$rootScope","$timeout","$location","$routeParams",function(a,b,c,d,e,f){b.msg_red_see=!1,b.choiceStyle=f.defineId,b.showImg=!1,b.settings={theme:"ios",mode:"scroller",display:"inline",lang:""},b.init=function(){1==f.defineId?a({url:api_uri+"loanApplication/detail/"+f.id,method:"GET",params:c.login_user}).success(function(a){console.log(a),0==a.returnCode?b.company=a.result:console.log(a)}).error(function(a){e.path("/error")}):a({url:api_uri+"loanApplication/myDetail/"+f.id,method:"GET",params:c.login_user}).success(function(a){console.log(a),0==a.returnCode&&(b.company=a.result,0==b.company.status||1==b.company.status?(b.company.jindu="10",b.company.progressText="准备中",b.company.statusNextText="下户",b.company.progressNext="审核中",b.progressTextNext="开始下户",b.company.message=!0):2==b.company.status?(b.company.jindu="25",b.company.progressText="下户",b.company.statusNextText="审批中",b.company.progressNext="审核中",b.progressTextNext="开始审批",b.company.message=!0):3==b.company.status?(b.company.jindu="40",b.company.progressText="审批中",b.company.statusNextText="审批通过",b.company.progressNext="审核中",b.progressTextNext="审核通过",b.company.message=!0):4==b.company.status?(b.company.jindu="55",b.company.progressText="审批通过",b.company.statusNextText="开户",b.company.progressNext="审核中",b.progressTextNext="马上开户",b.company.message=!0):5==b.company.status?(b.company.jindu="70",b.company.progressText="开户",b.company.statusNextText="放款",b.company.progressNext="审核中",b.progressTextNext="开始放款",b.message=!0):6==b.company.status?(b.company.jindu="85",b.company.progressText="放款",b.company.statusNextText="完成融资",b.company.progressNext="审核中",b.progressTextNext="成功融资",b.company.message=!0):7==b.company.status?(b.company.jindu="100",b.company.progressText="完成融资",b.company.message=!0):b.company.status==-1&&(b.company.jindu="0",b.company.triangle="20",b.company.textPosition="5",b.progressText="申请已经取消"))}).error(function(a){}),a({url:api_uri+"inforTemplate/showBase/"+f.id,method:"GET",params:c.login_user}).success(function(a){console.log(a),0==a.returnCode&&(b.template_list=a.result.templateList,b.template_list.length>0?(b.showImg=!0,console.log("true")):(b.showImg=!1,console.log("false")),b.company_basic=a.result)}).error(function(a){})},b.init(),b.alertCancel=function(){$(".coverAlert").css("display","block"),$(".cancelAlert").css("display","block")},b.alertExit=function(){$(".coverAlert").css("display","none"),$(".cancelAlert").css("display","none")},b.previewImages=function(a,b){wx.previewImage({current:a,urls:b})},b.cancel=function(){var b={userId:c.login_user.userId,token:c.login_user.token,status:0};a({url:api_uri+"loanApplication/cancel/"+f.id,method:"GET",params:b}).success(function(a){console.log(a),0==a.returnCode&&(alert("取消成功"),e.path("/user/center"))}).error(function(a){e.path("/error")})},b.alert=!1,b.alert_common=function(a,c,d){b.dateTime=d,b.alert=!0,b.applyId=c,b.status=a,$(".alert").css("top",$(document).scrollTop()),b.alertText="预计时间",b.alertText2="如需备注请在次进行描述"},b.alert_stop=function(){console.log("ddd"),alert("asdfa")},b.alert_come1=function(a,c,d){b.dateTime=d,b.alert=!0,b.applyId=c,b.status=a,$(".alert").css("top",$(document).scrollTop()),b.alertText="延长时间",b.alertText2="请说明原因（必填）"},b.closeAlert=function(a,c){b.alert=!1,b.stopPropagation&&c.stopPropagation()},b.submit_status=function(){var a={userId:c.login_user.userId,token:c.login_user.token,expectDateBank:b.dateTimePro,reason:b.reason,applyId:b.applyId,status:b.status};a.expectDateBank?$.ajax({type:"POST",url:api_uri+"applyBankDeal/refer",data:a,traditional:!0,success:function(a,c,d){0==a.returnCode?b.alert=!1:console.log(a)},dataType:"json"}):(b.msg_red="请输入预计时间",b.msg_red_see=!0,d(function(){b.msg_red_see=!1},3e3))}}]),userCtrl.controller("SettingCtrl",["$scope","$rootScope","$location","$http",function(a,b,c,d){a.init=function(){d({url:api_uri+"user/setting",method:"GET",params:b.login_user}).success(function(b){0==b.returnCode&&(a.user=b.result)}).error(function(a){}),d({url:api_uri+"qiniu/getUpToken",method:"GET",params:b.login_user}).success(function(c){if(0==c.returnCode){a.qiniu_token=c.result.uptoken;Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"pickfiles",uptoken:a.qiniu_token,domain:b.qiniu_bucket_domain,container:"upload_container",max_file_size:"10mb",flash_swf_url:"../../framework/plupload/Moxie.swf",max_retries:3,dragdrop:!1,drop_element:"",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(a,b){},BeforeUpload:function(c,d){b.uploading=!0,a.upload_percent=d.percent,b.$apply()},UploadProgress:function(b,c){a.upload_percent=c.percent,a.$apply()},FileUploaded:function(c,d,e){var f=$.parseJSON(e),g="http://"+b.qiniu_bucket_domain+"/"+f.key;a.user.headImg=g,a.$apply();var h=b.login_user;h.key="headImg",h.value=a.user.headImg,$.post(api_uri+"user/update",h,function(a){0==a.returnCode},"json")},Error:function(a,c,d){b.alert("头像上传失败！")},UploadComplete:function(){},Key:function(a,c){var d=(new Date).getTime(),e="user/headImg/"+b.login_user.userId+"/"+d;return e}}})}}).error(function(a){})},a.init(),a.reset=function(){c.path("/register/reset1")},a.update=function(a){c.path("/user/update/"+a)},a.logout=function(){d({url:api_uri+"auth/logout",method:"GET",params:b.login_user}).success(function(a){}).error(function(a){}),b.removeObject("login_user",b.login_user),b.login_user={},c.path("/login")}}]),userCtrl.controller("UserUpdateCtrl",["$scope","$rootScope","$location","$routeParams",function(a,b,c,d){a.typeKey=d.id,console.log(d.id),a.sure=function(){var d={userId:b.login_user.userId,token:b.login_user.token,j:JSON.stringify({name:a.userName,position:a.position})};console.log(d),$.ajax({type:"POST",url:api_uri+"user/updateNew",data:d,traditional:!0,success:function(a,b,d){console.log(a),0==a.returnCode?c.path("/user/setting"):console.log(a)},dataType:"json"}),c.path("/user/setting")}}]),userCtrl.controller("AddMessageCtrl",["$scope","$rootScope","$location",function(a,b,c){a.sure=function(){var d={userId:b.login_user.userId,token:b.login_user.token,j:JSON.stringify({name:a.userName,position:a.position})};$.ajax({type:"POST",url:api_uri+"user/updateNew",data:d,traditional:!0,success:function(a,b,c){0==a.returnCode||console.log(a)},dataType:"json"}),c.path("/user/setting")}}]),api_uri="http://123.206.84.74/api/",root_uri="http://test.zhironghao.com/#",activityID="e15813cb5bfd4290a5c2582cbdd164a4",templates_root="templates/",deskey="abc123.*abc123.*abc123.*abc123.*";var app=angular.module("app",["ng","ngRoute","ngAnimate","loginCtrl","registerCtrl","articleCtrl","userCtrl"],["$httpProvider",function(a){a.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8",a.defaults.headers.put["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8"}]);app.run(["$location","$rootScope","$http","$routeParams",function(a,b,c,d){b.qiniu_bucket_domain="o793l6o3p.bkt.clouddn.com";var e=["/article/list","/login","/register/step1","/register/step2","/register/reset1","/register/reset2"],f=navigator.userAgent.toLowerCase();b.wx_client=f.indexOf("micromessenger")!=-1,b.isIos=f.indexOf("iphone")!=-1||f.indexOf("ipad")!=-1,b.wx_client&&c({url:api_uri+"wx/share",method:"GET",params:{url:a.absUrl()}}).success(function(a){0==a.returnCode&&(wx.config({debug:!1,appId:a.result.appid,timestamp:a.result.timestamp,nonceStr:a.result.noncestr,signature:a.result.signature,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","hideMenuItems","showMenuItems","hideAllNonBaseMenuItem","showAllNonBaseMenuItem","translateVoice"]}),wx.ready(function(){}),wx.error(function(a){}))}).error(function(a){}),b.getUrl=function(a,e){e?(b.title=b.shareBankname+b.shareProductName,b.desc=b.desc_detail):a.indexOf("showActivity")>-1?(b.title="直融号8月活动",b.desc="千亿资金等你来拿"):(b.title="直融号",b.desc="打造企业最低融资成本");var f=[];f=a.split("?"),console.log(f),b.login_user&&(b.userId=b.login_user.userId),d.shareId&&(b.shareId=d.shareId);var g={url:f[0],userId:b.userId,from:0,shareId:b.shareId};$.ajax({type:"POST",url:api_uri+"wxShare/share",data:g,traditional:!0,success:function(a,d,e){console.log(a),0==a.returnCode&&(b.shareReturn=a.result,b.shareReturn.sn=a.result.sn,b.shareReturn.token=a.result.token,wx.onMenuShareAppMessage({title:b.title,desc:b.desc,link:api_uri+"wxShare/show?sn="+b.shareReturn.sn+"&token="+b.shareReturn.token,imgUrl:"http://app.supeiyunjing.com/img/share.png",success:function(){var a={sn:b.shareReturn.sn,token:b.shareReturn.token,to:"AppMessage"};c({url:api_uri+"wxShare/isShare",method:"GET",params:a}).success(function(a){})}}),wx.onMenuShareTimeline({title:b.title,desc:b.desc,link:api_uri+"wxShare/show?sn="+b.shareReturn.sn+"&token="+b.shareReturn.token,imgUrl:"http://app.supeiyunjing.com/img/share.png",success:function(){var a={sn:b.shareReturn.sn,token:b.shareReturn.token,to:"Timeline"};c({url:api_uri+"wxShare/isShare",method:"GET",params:a}).success(function(a){})}}),wx.onMenuShareQQ({title:b.title,desc:b.desc,link:api_uri+"wxShare/show?sn="+b.shareReturn.sn+"&token="+b.shareReturn.token,imgUrl:"http://app.supeiyunjing.com/img/share.png",success:function(){var a={sn:b.shareReturn.sn,token:b.shareReturn.token,to:"QQ"};c({url:api_uri+"wxShare/isShare",method:"GET",params:a}).success(function(a){})}}),wx.onMenuShareWeibo({title:b.title,desc:b.desc,link:api_uri+"wxShare/show?sn="+b.shareReturn.sn+"&token="+b.shareReturn.token,imgUrl:"http://app.supeiyunjing.com/img/share.png",success:function(){var a={sn:b.shareReturn.sn,token:b.shareReturn.token,to:"Weibo"};c({url:api_uri+"wxShare/isShare",method:"GET",params:a}).success(function(a){})}}))},dataType:"json"})},b.shareSuccess=function(a,b,d){var e={sn:a,token:b,to:d};c({url:api_uri+"wxShare/isShare",method:"GET",params:e}).success(function(a){})},b.$on("$routeChangeSuccess",function(e,f,g){function h(){wx.hideOptionMenu()}var i=a.$$path,j=d.openid;if(j){b.putObject("openid",j);var k={userId:b.login_user.userId,token:b.login_user.token,openid:j};c({url:api_uri+"user/wxBind",method:"GET",params:k}).success(function(a){})}if(b.removeSessionObject("showID"),"/article/list"==i||i.indexOf("/article/show/")>-1||"/article/showActivity"==i){var l=a.search().share;if(console.log(l),l){var m=a.search().shareId,n={shareName:l,shareId:m};b.putSessionObject("share",n)}console.log(n)}else"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",h,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",h),document.attachEvent("onWeixinJSBridgeReady",h)):h()}),b.$on("$routeChangeStart",function(c,d,f){var g=a.$$path;b.check_user(),b.login_user||e.indexOf(g)>-1||e.indexOf(g)<=-1&&g.indexOf("/article/show")>-1||e.indexOf(g)<=-1&&g.indexOf("register/step2")>-1||e.indexOf(g)<=-1&&g.indexOf("register/reset2")>-1||(b.removeObject("login_user"),b.putSessionObject("present_route",g),a.path("/login"))}),b.putObject=function(a,b){localStorage.setItem(a,angular.toJson(b))},b.getObject=function(a){return angular.fromJson(localStorage.getItem(a))},b.removeObject=function(a){localStorage.removeItem(a)},b.putSessionObject=function(a,b){sessionStorage.setItem(a,angular.toJson(b))},b.getSessionObject=function(a){return angular.fromJson(sessionStorage.getItem(a))},b.removeSessionObject=function(a){angular.fromJson(sessionStorage.removeItem(a))},b.change=function(a){a.stopPropagation()},b.isNullOrEmpty=function(a){return""==$.trim(a)||null==a||void 0==a},b.encryptByDES=function(a){var b=CryptoJS.enc.Utf8.parse(deskey),c=CryptoJS.DES.encrypt(a,b,{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7});return c.toString()},b.decryptByDES=function(a){var b=CryptoJS.enc.Utf8.parse(deskey),c=CryptoJS.DES.decrypt({ciphertext:CryptoJS.enc.Base64.parse(a)},b,{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7});return c.toString(CryptoJS.enc.Utf8)},b.transFn=function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&").toString()},b.touchStart=function(){$(".singleButtonFixed").addClass("singleButton2"),$(".singleButton1").addClass("singleButton2")},b.touchEnd=function(){$(".singleButtonFixed").removeClass("singleButton2"),$(".singleButton1").removeClass("singleButton2")},
b.check_user=function(){return b.login_user=b.getObject("login_user"),b.login_user?void c({url:api_uri+"auth/validateAuth",method:"POST",params:b.login_user}).success(function(c){return 0==c.returnCode||(b.removeObject("login_user"),b.present_route=a.$$path,e.indexOf(b.present_route)<=-1&&b.present_route.indexOf("article/show")<=-1&&b.present_route.indexOf("register/step2")<=-1&&b.present_route.indexOf("register/reset2")<=-1?b.putSessionObject("present_route",b.present_route):(b.present_route="/login")&&b.putSessionObject("present_route",b.present_route),!1)}).error(function(a){return!1}):(b.removeObject("login_user"),b.present_route=a.$$path,!1)},window.localStorage||alert("This browser does NOT support localStorage"),window.sessionStorage||alert("This browser does NOT support sessionStorage")}]),app.directive("ngTouchend",function(){return{controller:function(a,b,c){function d(c){var d=b.attr("ng-touchend");a.$event=c,a.$apply(d)}b.bind("touchend",d)}}}),app.directive("ngTouchmove",function(){return{controller:function(a,b,c){function d(a){a.preventDefault(),b.bind("touchmove",e),b.bind("touchend",f)}function e(c){var d=b.attr("ng-touchmove");a.$event=c,a.$apply(d)}function f(a){a.preventDefault(),b.unbind("touchmove",e),b.unbind("touchend",f)}b.bind("touchstart",d)}}}),app.directive("ngTouchstart",function(){return{controller:function(a,b,c){function d(c){var d=b.attr("ng-touchstart");a.$event=c,a.$apply(d)}b.bind("touchstart",d)}}}),app.animation(".fad",function(){return{enter:function(a,b){a.css({opacity:0}),a.animate({opacity:1},400,b)},leave:function(a,b){a.css({opacity:1}),a.animate({opacity:0},200,b)}}}),app.config(["$routeProvider",function(a){a.when("/login",{templateUrl:templates_root+"login/login.html",controller:"LoginCtrl"}).when("/register/step1",{templateUrl:templates_root+"register/step1.html",controller:"RegStep1Ctrl"}).when("/register/step2/:mobile/:token",{templateUrl:templates_root+"register/step2.html",controller:"RegStep2Ctrl"}).when("/register/reset1",{templateUrl:templates_root+"register/reset1.html",controller:"ResetStep1Ctrl"}).when("/register/reset2/:mobile/:token",{templateUrl:templates_root+"register/reset2.html",controller:"ResetStep2Ctrl"}).when("/article/list",{templateUrl:templates_root+"article/list.html",controller:"ArticleListCtrl"}).when("/article/showActivity",{templateUrl:templates_root+"article/showActivity.html",controller:"ArticleShowActivityCtrl"}).when("/article/show/:id",{templateUrl:templates_root+"article/show.html",controller:"ArticleShowCtrl"}).when("/article/apply/:id:type",{templateUrl:templates_root+"article/apply.html",controller:"applyCtrl"}).when("/user/center",{templateUrl:templates_root+"user/center.html",controller:"UserCenterCtrl"}).when("/user/message",{templateUrl:templates_root+"user/message.html",controller:"MessageCtrl"}).when("/user/companyDetail/:id/:defineId",{templateUrl:templates_root+"user/company_detail.html",controller:"CompanyDetailCtrl"}).when("/user/setting",{templateUrl:templates_root+"user/setting.html",controller:"SettingCtrl"}).when("/user/add_name",{templateUrl:templates_root+"user/add_name.html",controller:"AddMessageCtrl"}).when("/user/update/:id",{templateUrl:templates_root+"user/update.html",controller:"UserUpdateCtrl"}).when("/error",{templateUrl:templates_root+"404.html"}).otherwise({redirectTo:"/login"})}]);